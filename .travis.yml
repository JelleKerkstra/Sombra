sudo: required
language: csharp
services:
- docker
env:
  DOCKER_COMPOSE_VERSION: 1.19.0

install:
  # update is required to update the repositories to see the new packages for
  # Docker.
  - curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
  - sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"
  - sudo apt-get update
  - sudo apt-get -y install docker-ce

  # Print out the current docker-compose version. Once this reports 1.6+ then we
  # do not need the following steps.
  - docker-compose --version

  # As of the writing of this script Travis has docker-compose v1.4.2, we need
  # to update it to 1.19+. $DOCKER_COMPOSE_VERSION is provide from the `env`
  # above.
  - sudo rm /usr/local/bin/docker-compose
  - curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname -s`-`uname -m` > docker-compose
  - chmod +x docker-compose
  - sudo mv docker-compose /usr/local/bin

  # Check that docker-compose is now running the latest version (or at least the
  # one we specified). This is not to be confused with the version we printed
  # before doing the update.
  - docker-compose --version

  # You will want this for logging. If one of your containers does not build for
  # whatever reason it's best to report that now before your tests start
  # otherwise it can be really tricky to debug why tests are failing sometimes.
  - docker ps

before_script:
  - chmod -R a+x scripts

script: 
  - ./scripts/dotnet-build.sh
  - ./scripts/dotnet-test.sh

after_success:
  - ./scripts/after-success.sh

before_install:
- curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
- sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu
  $(lsb_release -cs) stable"
- sudo apt-get update
- sudo apt-get -y install docker-ce
- docker-compose --version
- sudo rm /usr/local/bin/docker-compose
- curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname
  -s`-`uname -m` > docker-compose
- chmod +x docker-compose
- sudo mv docker-compose /usr/local/bin
- docker-compose --version
- docker-compose build
- docker-compose up -d
- docker ps
script:
- "./script.sh"
after_install:
- docker-compose down
notifications:
  slack:
    secure: WQB36HqMnK8L64eTGjKtNSooNAg7DRzARF2MKgMiV06MPfNTJwIgorX3FlwriNKaRUmOaQ7tUKVGggL09kokDrF2wBCckym2P+q4g7rlkjgFqMw3Klp0krHRNwnoueh5nwkN3cjif9d+GcyjvTGUdlFuRMDwa/ih5W61Nk9JLN6h7FCg33jc9di4FtHnRSTC76M3E5AEY7c9lyt5HYXxgMHJXG8XEAgu6gNl1nr0EfkEyjYaCWHoBffrqrFuVQfekmok8xc+TAMvHbhIK1DcDFW2DkLr64+pidJv/ZQ1oYr6rIoJCLv+UbzgIfYO6b8CYkqPYRlA1WWGbBPFPAo36T4AGn4/e76IfRpEQOEGQsPBuRI8KbF5nCgZtLP/EyFqg1/i92lqXhMX/TI98uIHAVmHuGmQQkAIWqbfxwILT2XeMILxVNZSp2NEn6XT8EK5AjG8uFoQq5D3L85t5ERc/3gM5Xr2CmbPNiGPk834NIL0qyQ+dFCie5kPQvpFgaq1MtSTvQegPSEi1AIZLD7wGQtwaIPOWnZeFOLctrOFT2UB9Ov36W2ezWIMejKWNw+N/NnJPvVT450SmI8tvJE72sPMDvqDS5TkO7xxEPyxzhTibBPNP/nwSSY+nZ40P+LE+x4/DjJTc1YrVVsOKDJEHepp8mvAN7gifu8huewKPKQ=
